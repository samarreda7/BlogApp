@{
    ViewData["Title"] = "Search Users";
}

<div class="container mt-5">
    <h2>Search Users</h2>

    <div class="mb-4">
        <input type="text" id="searchInput" class="form-control"
               placeholder="Search by name or username..." />
    </div>

    <div id="searchResults" class="list-group">
        
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const resultsContainer = document.getElementById('searchResults');

            if (!searchInput || !resultsContainer) {
                console.error("Search elements not found!");
                return;
            }

            searchInput.addEventListener('input', async function () {
                const query = this.value.trim();
                console.log("Searching for:", query);

                if (query.length < 2) {
                    resultsContainer.innerHTML = '';
                    return;
                }

                try {
                    const response = await fetch(`/Auth/SearchUsers?q=${encodeURIComponent(query)}`);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const users = await response.json();
                    console.log("Users:", users);

                    resultsContainer.innerHTML = '';

                    if (users.length === 0) {
                        resultsContainer.innerHTML = '<div class="list-group-item">No users found.</div>';
                        return;
                    }

                    users.forEach(user => {
                        const a = document.createElement('a');
                       a.href = `/Post/Profile/${user.userName}`;
                        a.className = 'list-group-item list-group-item-action d-flex align-items-center';
                        a.innerHTML = `
                            <div class="rounded-circle bg-primary text-white text-center me-3"
                                 style="width: 40px; height: 40px; line-height: 40px;">
                                ${user.firstName?.[0] || '?'}
                            </div>
                            <div>
                                <strong>${user.firstName}</strong><br/>
                                <small>@@${user.userName}</small>
                            </div>
                        `;
                        resultsContainer.appendChild(a);
                    });
                } catch (err) {
                    console.error("Search error:", err);
                    resultsContainer.innerHTML = '<div class="list-group-item text-danger">Error loading results.</div>';
                }
            });
        });
    </script>
}